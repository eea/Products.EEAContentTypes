<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="eea">
  <body>
    <metal:content-core fill-slot="content-core">
      <metal:content-core define-macro="content-core">

        <tal:relatedItems tal:define="related context/getRelatedItemsRaw;
                                      titles python:context.getStory_titles().split('\r\n');
                                      titles_len python: len(titles);
                                      related_len python: len(related);
                                      fewer_titles python: titles_len < related_len;">
            <div class="visualClear" id="clear-space-before-relatedItemBox"><!-- --></div>
          <tal:messages tal:condition="fewer_titles">
            <div class="portalMessage errorMessage">
              <p>There are fewer titles than related items.</p>
              <p>Either add more titles or remove extra related items.</p>
            </div>
          </tal:messages>
          <h2 i18n:domain="eea" i18n:translate="">Story titles</h2>
            <ul class="visualNoMarker">
                <tal:related tal:repeat="item related">
                <li>
                    <span tal:attributes="class string:visualIcon">
                    <h5 i18n:domain="eea" i18n:translate=""
                        tal:define="item_number python: repeat['item'].index();"
                        tal:content="python:titles[item_number] if item_number < titles_len else ''"> Story title </h5>
                    <span class="eea-icon eea-icon-arrow-right"></span>
                    <a href="" class=""
                       tal:attributes="href  python:item['url'];
                                       title python:item['title']"
                       tal:content="python:item['title']">
                           Related Item
                    </a>
                    </span>
                </li>
                </tal:related>
            </ul>
        </tal:relatedItems>

        <h2 i18n:domain="eea" i18n:translate="">Body text</h2>
        <metal:field use-macro="python:context.widget('text', mode='view')">
          Body text
        </metal:field>

        <h2 i18n:domain="eea" i18n:translate="">Full story description</h2>
        <metal:field use-macro="python:context.widget('full_story_description',
                                                      mode='view')">
          Full story description
        </metal:field>

      </metal:content-core>
    </metal:content-core>
  </body>
</html>
