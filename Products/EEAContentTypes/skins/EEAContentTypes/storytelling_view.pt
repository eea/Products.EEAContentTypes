<tal:block tal:define="foo python:request.set('disable_plone.leftcolumn', 1);
    bar python:request.set('disable_plone.rightcolumn', 1);"/>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="eea">
  <body>
    <metal:content-core fill-slot="main">
      <metal:content-core define-macro="main">
          <metal:body metal:define-macro="storybody">
          <div class="storytelling-wrapper" tal:define="storyitem  nocall: story | nocall: context;
              relations storyitem/getRelatedItemsRaw|nothing;">
        <tal:relatedItems tal:define="titles python:storyitem.getStory_titles().split('\r\n');
                                      num_of_titles python: len(titles);
                                      num_of_relations python: len(relations);
                                      fewer_titles python: num_of_titles < num_of_relations;">
          
          <div class="visualClear" id="clear-space-before-relatedItemBox"><!-- --></div>
          <tal:messages tal:condition="fewer_titles">
            <div class="portalMessage errorMessage" tal:condition="python: not isAnon and storyitem == context">
              <p i18n:translate="">There are fewer titles than related items.</p>
              <p i18n:translate="">Either add more titles or remove extra related items.</p>
            </div>
          </tal:messages>

          <div class="storytelling-header">
              <a href="#" class="storytelling-link" tal:attributes="href storyitem/absolute_url">
                <h2 tal:content="storyitem/Title" class="dark-color"></h2>
              </a>
              <p tal:content="storyitem/Description"></p>
            </div>
            <div class="storytelling-body">
              <tal:items tal:repeat="relation relations" tal:condition="relations">
                <tal:defines tal:define="
                    repeat_num python: repeat['relation'].index;">
                  <div class="eea-card" tal:define="url relation/url; relation_with_description python: repeat_num == 2; fullwidth python: relation_with_description or num_of_relations == 1" tal:attributes="class python:'eea-card eea-card--double eea-card--landscape direction-column' if not relation_with_description and num_of_relations != 1 else 'eea-card eea-card--landscape eea-card--fullwidth'">
                    <div class="eea-card-header">
                      <div class="eea-card-title-wrapper">
                        <div class="eea-card-title">
                          <a href="#" class="eea-card-link" tal:attributes="href url">
                            <h2 tal:content="python: titles[repeat_num] if repeat_num < num_of_titles else ''"></h2>
                          </a>
                        </div>
                      </div>
                    </div>
                    <div class="eea-card-body">
                      <div class="eea-card-image-wrapper">
                        <a href="#" class="eea-card-image-link" tal:attributes="href url">
                          <img tal:attributes="src string:${url}/${image_scale}; width thumbnail/width; height thumbnail/height" alt=""
                               tal:define="image_scale python: 'image_large';
                                          brain relation/brain;
                                          obj brain/getObject;
                                          scales obj/@@images;
                                          thumbnail python: scales.scale('image', 'large')" class="skip_lazy eea-card-image eea-card-image--pull"  />
                        </a>
                      </div>
                      <div class="eea-card-body-text"  tal:condition="fullwidth">
                        <p tal:replace="structure storyitem/full_story_description"></p>
                      </div>
                    </div>
                    <div class="eea-card-footer">
                      <a href="#" tal:attributes="href url" class="moreLink">&nbsp;</a>
                    </div>
                  </div>
                </tal:defines>
              </tal:items>
            </div>
           </tal:relatedItems>
          </div>
        </metal:body>
      </metal:content-core>
    </metal:content-core>
  </body>
</html>
